[Revision September 2025 - JasonACT]
Pi Pico[W] Peripheral Expansion Box Side Port Device:

Licence:
This device must not be sold as a commercial product, it must not be "passed on" with the speech synthesizer enabled (which is GPL code, only owner-builders should enable this).
The Pico in this device is being pushed beyond its OEM limitations in 3 ways:
1/ It needs to be overclocked to 250MHz (which is a fairly safe thing to do)
2/ It is connected directly to some 5v TTL (74LS...) outputs on the TI bus (which is said to be fairly safe)
3/ I don't bother to add caps everywhere they may be needed, simpler to build, but not so professional, important capacitors are specified though.
Since it's all a bit out of spec. it needs to remain as a hobby device, assembled by the end user, who understands all the risks.
And most importantly, the famous line quoted in many TI things on the web... "I made no money from this, so why should you?"

IMPLEMENTED: (Mostly in the order done)
.Board in the size and shape of a real TI Speech Synthesizer
.Speech Synthesizer implementation using PWM
.32KB Expanded Memory (using Pico memory if desired, but also PSRAM that can implement SAMS, see below...)
.DSR RAM/ROM Memory - 4KB ROM area + 5 * paged 4KB (20KB) RAM areas in >5000=>5FFF
.GRAM/GROM Cartridge + Multi-bank RAM/ROM, E.G. 40KB GROM & 16KB+ ROM (+MiniMem-RAM) +++ PSRAM expands this considerably
.Load   Interrupt Capable (Used to enable the USB subsystem [keyboard & joystick])
.ExtInt Interrupt Capable (Used to enable RS232 non-blocking reads)
.USB Keyboard Interface "<ALT>=" is the normal TI-99 reset, but <CTRL><ALT>DEL can perform a full reset if <ALT>'=' has been locked out,
.USB Keyboard Interface  <CTRL><ALT>F11 is a keyboard to joystick toggle (enables TAB and Arrow keys as a joystick), <CTRL><ALT>F12 is a keyboard-state reset, should keys get stuck
.USB Joystick Interface (4 way Hat switch & 4 buttons + includes 1 analog stick converted to digital)
.USB Mouse interface - TIPI style which can also do Mechatronics style using the available TIPI drivers
.DSK/x - Via the SD Card, including listing directories w/o the 127 file limit
.RAW File read and write support (these work with sectors, but are not direct sector I/O)
.PIO - List to SD Card text-file (/spool.txt)
.Using TCP/IP & standard time-server to set the Pico clock for proper file system timestamps
.SAMS Memory Expansion, using a PSRAM chip, size configurable at build-time
.RS232 - Via Pico's free Serial2 port.  Uses a fixed BAUD rate, see below in the defines, .cfg file can override
.PI.CLOCK - WiFi on the Pico W - Special read-only file (set via a NTP time-server mentioned above) also defined as just 'CLOCK'
.Sockets - WiFi on the Pico W - RS232/2 - port:2322 (Server socket - with single client auto-connect)
.Sockets - WiFi on the Pico W - PI.TCP=... (a single Client-Only socket)
.Sockets - WiFi on the Pico W - Extension-TCP (a single Client-Only socket)
.DSK1 automap when E.G. CALL TIPI("/x/y/DSK1ea/TIEA") loads a module (TI E/A here) from a path with a "last" path component starting with "DSK1" - which gets automapped
.Math Co-Processor implements faster Add (and Sub) Multiply and Divide for Radix-100 floating point numbers (requires USB subsystem)
.PCode Card, with "PCode.ROM", "PCode.GRM" in the SD Card's root, must be 12KB & 62KB (or 64KB) merged G/ROM dumps
.mydisk.DSK sector-dump disk images mapped via CALL MAP1...MAP9 accessed via a special build of the TI Disk Controller Card's DSR ROM (needed for PCode usage, but generally useful)
.(Note 1: The TI Disk Controller Card's DSR requires sector image file names to end with ".DSK" to be properly detected otherwise SD Card directories are assumed)
.(Note 2: Mapping a track-dump .DSK file may [or may not] work but it will be converted to a RAM DISK [read only] but can be converted to a sector dump file by the ",RR" postfix)
.Action-Reply (VDPREGS - because recording them was important to the implementation) <CTRL><ALT>Print-Screen to save, <CTRL><ALT>Win-Menu to restore (Doesn't support SAMS or PCODE)
.Myarc 512KB RAM [switchable] (turns off SAMS to reuse its memory and CRU base - I.E. A Foundation card @ CRU >1E00)
.A USB Memory Stick will mount as a DSK device (DSK3 by default) for a single directory device
.Digi-Port emulation for sound, if the speech synth is enabled
.ForTI sound card emulation using a connected BT speaker
.Bluetooth Gamepads (joystick 1 and 2 specified by the 6 byte BT device address)
.Bluetooth Keyboard & Mouse (ditto^^)
.Console Tester
.Reset Switch (LOAD int)
.Debugger Card
.IDE Card
.SPEECH/ALPHON Text to Speech

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
Uses 1 Pico PIO state machine to squeeze the most out of PSRAM, the Pico[W] needs to run at 250MHz to get the 125MHz PSRAM clock right.
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

DSR Concept:
The idea here being, the DSR ROM is only 4KB (so don't add any more code!), but with 20KB of RAM available (in the >5000 space when paged in 4KB blocks).
The DSR will copy the PAB from VDP RAM into the 1st upper 4KB RAM page.  For Read/Writes, it will also use that area for a buffer.
For LOAD/SAVE which can be quite a lot larger, it will use the 16KB of the higher pages.  The Pi Pico sees all this as sequential RAM.

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

TI DSR Devices available:
TIPI    - SD card root access
DSK     - SD card root access (allows access to disks via their name, if a directory in SD Root is that name, or a .DSK is mounted)
DSK1    - /DSK1/ SD card access + AUTOMAP (all current maps survive a reset)
...
DSK9    - /DSK9/ SD card access
PIO     - /spool.txt SD card access
PIO/1   - /spool.txt SD card access (same as above)
RS232   - Pico serial port access
RS232/1 - Pico serial port access (same as above)
RS232/2 - Pico tcpip port:2322 access
PI      - Currently, only PI.CLOCK as a read-only file & PI.TCP as a single client socket are implemented
CLOCK   - Same as PI.CLOCK
SOCI    - RS232/2's socket for output, but socket input is directed into the special keyboard CRU input interface (because, why not.)

NB: The single client socket may be used via the TIPI extensions protocol instead (also how the TIPI mouse interface operates).

TI Basic Commands available:
TIPI    - CALL TIPI                 ; Builds a /cat.txt file the first time after power-on (or SD re-mount) and presents a menu to select Cart ROMs that can be loaded, press SPACE for config
TIPI    - CALL TIPI("/cartprefix")  ; Loads GROM/ROM with a cartridge SD card image (C/D/8/-8/_8/_9/G), MAME .ZIP/.RPK (don't type .ext), or EA5 loader (TIFILES & no .ext)
EXPON   - CALL EXPON                ; Turns 32KB expansion memory on
EXPOFF  - CALL EXPOFF               ; Turns 32KB expansion memory off
CARTON  - CALL CARTON               ; Turns Cartridge memory on
CARTOFF - CALL CARTOFF              ; Turns Cartridge memory off
CARTMMO - CALL CARTMMO              ; Turns 8/4KB of cartridge memory into RAM
CARTMMF - CALL CARTMMF              ; Turns off the Mini-Memory RAM mode
JOY0    - CALL JOY0                 ; Joystick keypads are NOT locked out                        [default] : "ALPINER" mode (all directions available)
JOY1    - CALL JOY1                 ; Joystick keypads are locked into 4 directions, newest takes priority : "MUNCHMAN" mode
JOY2    - CALL JOY2                 ; Joystick keypads are locked into 4 directions, oldest takes priority : "PARSEC" mode
JOYOFF  - CALL JOYOFF               ; Stops the CRU interface part of joysticks, allowing the TIPI extension to have full joystick control (more buttons)
MATHON  - CALL MATHON               ; Turns on the math co-processor
MATHOFF - CALL MATHOFF              ; Turns off the math co-processor [default]
PCODEON - CALL PCODEON              ; Turns on the PCode Card - and reboots the TI into PCode mode
PCODEOF - CALL PCODEOF              ; Turns off the PCode Card [default] (to use this, PCode 'H'alt must be used, clearing low-mem would otherwise restart the PCode Card on a reset)
MYARCON - CALL MYARCON              ; Turns SAMS memory into Myarc mode
MYARCOF - CALL MYARCOF              ; Turns off Myarc mode, back to SAMS
UNMOUNT - CALL UNMOUNT              ; Unmounts the SD card so it can be ejected (the next SD Card access re-mounts automatically) - Also saves the bluetooth & IDE config
MAP1    - CALL MAP1("/dir")         ; Like DSK1 automap, this allows the user to select the directory mapped to DSK1.  If a path to a .DSK file is entered,
...                                 ; then the custom TI Disk DSR is used for the sector dump file specified.  With 8MB PSRAM, these can all be RAM-read-cached with "xxx.DSK,RC"
MAP9    -                           ; or with "xxx.DSK,RO" can be pre-formatted with the file's data and then used as a true RAM DISK (I.E. fast writes to RAM, but not persistent).
FLUSH   - CALL FLUSH(1)             ; With "xxx.DSK,RO" RAM DISKs, you can write back changed data at a later point in time using CALL FLUSH(drive-number) [but not with BLNK.DSK, see below]
MAPCS1  - CALL MAPCS1("/dir/file")  ; This allows the user to select a TIFILES file mapped for CS1 \_ For the CALL TIPI config menu, use a file extension of ".CS" for easier configuration
MAPCS2  - CALL MAPCS2("/dir/file")  ; This allows the user to select a TIFILES file mapped for CS2 /
PASTE   - CALL PASTE("/dir/file")   ; Pastes from a file, via the keyboard CRU interface, end filename with ":" for USB keyboard <CTRL><ALT>F10 start-signal
FILES   - CALL FILES(3)             ; Only available when the CRU address is defined as >1100

NB: The MAME .ZIP / .RPK archive loader requires about 84KB of free RAM to function properly, making a 2MB/8MB PSRAM chip necessary to free up space (archived files must end with C/D/G/8/9)
NB: The supplied BLNK.DSK is a small 2 sector disk image that can be used with the "BLNK.DSK,RO" command to format a temporary empty 400KB RAM DISK (only ever use ",RO" with this file)
NB: For ",RO" RAM DISKs, MAP1..MAP9 can specify a new DSK file with "xxx.DSK,RR" which will take the existing RAM contents and write ('R'estore) it to the new file (overwrites old files)

The CD Card root file: /autoload.cfg can be used to set start up defaults:
cru_base    "CRU="   (the card offsets starts at >1000, this parameter is a single digit 0-9, A-D [E & F are reserved] - Note: the default CRU base is specified by DSR1_CRU below for >1100)
baudrate    "BAUD="  (override the default single BAUD rate we allow for the RS232 / DEBUG Pico serial port)
wificntrycd "WFCC="  (See below for 2 char codes, do not change this frequently, it will wear out the flash memory page, also requires a power-cycle when first setting up or changing)
wifissid    "WIFI="  (to connect to a WiFi network, this is the network name)
password    "PASS="  (your password)
timeserver  "SNTP="  (where to get the current time from)
timehour    "TZHR="  (timezone hours offset)
timemins    "TZMN="  (timezone minutes offset)
timeformat  "TMFT="  (0=US %m/%d/%y, 1=AUS %d/%m/%y)
map-cs1     "C1MAP="
map-cs2     "C2MAP="
map-dsk1    "D1MAP=" ...
map-dsk9    "D9MAP="
filename    "CART=", "CART2=", "CART3=", etc. to autoload command modules (..2 onwards needs the module library feature enabled)
MM RAM ENAB "MMEM="  (0=off, 1=on, default is off)
MM 8/4K RAM "MMMD="  (0=8KB, 1=4KB, default is 8KB)
pcode-on    "PCODE=" (0=off, 1=on, default is off)
Myarc mode  "MYARC=" (0=off, 1=on, default is off)
Pico Speed  "MHZ="   (The pico starts at a fixed speed [as set in Arduino] but can be dynamically adjusted using this setting - limited to even values between '250' and '280' MHz)
Pico NOPs   "NOPS="  (The number of NOP instructions to use for the delay between a memory access [*MEMEN] and starting to read the address lines - valid value ranges from 1 to 9)
Pico NOPs2  "NOPSW=" (After a write instruction, when the *WE signal goes back to high, this allows different delay time before restarting the loop.. default 5, valid values 1..9)
USB Drive   "USBD="  (If a USB memory stick is inserted, this DSKx number will be temporarily overridden - a value from 1 to 9)
PIO Sound   "PSNDO=" (=1 means turn on this feature)
BT Joystick "BTJ1="  (Specified in the hex format HH:HH:HH:HH:HH:HH  ---> Specifying BTJ1 in the config file prevents a USB GamePad from being Joystick 1)
BT Joystick "BTJ2="  (Specified in the hex format HH:HH:HH:HH:HH:HH)
BT Keyboard "BTKM1=" (Specified in the hex format HH:HH:HH:HH:HH:HH)
BT Mouse    "BTKM2=" (Specified in the hex format HH:HH:HH:HH:HH:HH)
BT5 KeyBd   "BT5KB=" (Specified in the hex format HH:HH:HH:HH:HH:HH)
BT Speaker  "BTSPK=" (Specified in the hex format HH:HH:HH:HH:HH:HH)
ForTI Sound "FORTI=" (Sound gets sent to a BT Speaker - with the following options...
                      =0 off,
                      =1 means one chip emulated    - BT Speaker plays left & right channel in mono the same as the TI,
                      =2 means all 4 chips emulated - BT Speaker plays in stereo,
                      =3 means all 4 chips emulated - BT Speaker plays in mono)
SAMS RAMBO  "RAMBO=" (=1 turns on SAMS RAM at >4000 when no DSR ROM is enabled)
PlayThing   "PLAYT=" (=1 turns on ROM/RAM at CRU >1D00)
The IDE Card "IDE="  (=1 turns on the IDE card at CRU > 1200 - Supports exFAT image files, or RAW devices)
             "HARDDISK1=" (Master IDE image file, if not using a RAW device)
             "HARDDISK2=" (Slave  IDE image file, if not using a RAW device)
ConsoleTester "TSTR=" (=1 turns on the Console Tester, file "constest.rom" is provided)
LOAD int    "KBLOAD=" (=1 turns on <CTRL><ALT><PAUSE> as the LOAD interrupt button
RESET       "RESET=1" (Turns the 'normally' TX serial pin into an input, reset the TI and reload the default cart image)
SPEECH      "SPEECH=1"(Turns on the SPEECH device [Terminal Emulator II] for the text to speech DSR functions SPEECH and ALPHON)
TIMESTAMPS  "TIMEST=1"(Turns on 146 byte length directory records, default is 0 which is the standard 38 byte length records, =2 makes timestamps 2 digit years)
SID         "SID=1"   (Turns on the Sid Master 99 device)

CRU Map:
    >1000 = PicoPEB DSK (if selected via CRU=0 config, FILES left to card @>1100)
    >1100 = PicoPEB DSK (default, FILES=3)
    >1200 = IDE Card (can be set to any below >1E, IDE=0 to IDE=D)
    >1300 = RS232 Card for Digi-Port emulation (no real RS232 stuff here, so is compatible with a real card)
    >1D00 = PlayThing (not enabled - see below)
    >1E00 = SAMS Card
    >1F00 = PCode Card

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

WiFi Country Codes - When changing the .cfg file to a new value, power-up the TI and wait for the title screen, then power-down and power-up again.

WORLDWIDE      XX <- This is the default
AUSTRALIA      AU    ESTONIA   EE    ITALY         IT    NETHERLANDS NL    SLOVENIA     SI
AUSTRIA        AT    FINLAND   FI    JAPAN         JP    NEW_ZEALAND NZ    SOUTH_AFRICA ZA
BELGIUM        BE    FRANCE    FR    KENYA         KE    NIGERIA     NG    SOUTH_KOREA  KR
BRAZIL         BR    GERMANY   DE    LATVIA        LV    NORWAY      NO    SPAIN        ES
CANADA         CA    GREECE    GR    LIECHTENSTEIN LI    PERU        PE    SWEDEN       SE
CHILE          CL    HONG_KONG HK    LITHUANIA     LT    PHILIPPINES PH    SWITZERLAND  CH
CHINA          CN    HUNGARY   HU    LUXEMBOURG    LU    POLAND      PL    TAIWAN       TW
COLOMBIA       CO    ICELAND   IS    MALAYSIA      MY    PORTUGAL    PT    THAILAND     TH
CZECH_REPUBLIC CZ    INDIA     IN    MALTA         MT    SINGAPORE   SG    TURKEY       TR
DENMARK        DK    ISRAEL    IL    MEXICO        MX    SLOVAKIA    SK    UK           GB    USA  US

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

8MB PSRAM Memory Map (SAMS configured for 1MB and PCODE is enabled)

   1MB      2MB      3MB      4MB      5MB      6MB      7MB      8MB
 ________ ________ ________ ________ ________ ________ ________ ________
|  SAMS  |  ROM-->|------->|----->GROM->|DSK9| DSK876 | DSK543 | DSK21 || <-- last small gap = 64KB PCode Card GROMs + its 8KB ROM
|________|________|________|________|___|____|________|________|_______||

ROMs can be loaded into the GROM and DSK Cache space (if GROM/DSK are not being used) for an extra large Command Module
GROMs expand 'backwards' into ROM space as the number of Command Modules #defined below increases (only Cart 0 uses PSRAM for ROMs)
DSK space is only used when mapping sector based .DSK files, and when the special filename modifiers are specified for caching.

When PROTECTGROMS == 1 the map changes slightly: (here we are showing SAMS configured as 2MB)

   1MB      2MB      3MB      4MB      5MB      6MB      7MB      8MB
 ________ ________ ________ ________ ________ ________ ________ ________
|  SAMS--|------->|ROM-----|--------|->|DSK9 | DSK876 | DSK543 | DSK21||| <-- last small gap = 64KB PCode Card GROMs + its 8KB ROM
|________|________|________|________|__|_____|________|________|______||| <-- 2nd last gap = Cart GROM, 1=40KB, 2=80KB, 3=120KB etc.
 
